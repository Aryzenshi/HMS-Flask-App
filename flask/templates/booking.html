{% extends "base.html" %}

{% block content %}

{% if step == 1 %}
<!-- STEP 1: DATE SELECTION -->
<div class="bg-white p-6 rounded-xl container-shadow">
    <h2 class="text-2xl font-bold text-indigo-600 mb-4">Step 1: Select Dates</h2>
    <form method="POST" action="{{ url_for('booking') }}" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="checkin" class="block text-sm font-medium text-gray-700">Check-in Date</label>
                <input type="date" id="checkin" name="checkin" value="{{ default_checkin }}" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>
            <div>
                <label for="checkout" class="block text-sm font-medium text-gray-700">Check-out Date</label>
                <input type="date" id="checkout" name="checkout" value="{{ default_checkout }}" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>
        </div>
        <button type="submit"
            class="w-full md:w-auto px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
            Search Available Rooms
        </button>
    </form>
</div>

{% elif step == 2 %}
<!-- STEP 2: ROOM SELECTION & CUSTOMER INFO -->
<form method="POST" action="{{ url_for('complete_booking') }}" class="space-y-6">

    <!-- Hidden Inputs for Dates -->
    <input type="hidden" name="checkin_date" value="{{ checkin }}">
    <input type="hidden" name="checkout_date" value="{{ checkout }}">

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Room Selection Panel -->
        <div class="lg:col-span-1 bg-white p-6 rounded-xl container-shadow h-min">
            <h2 class="text-xl font-bold text-indigo-600 mb-4">Room Selection</h2>
            <p class="text-sm text-gray-600 mb-4">
                Availability for:
                <span class="font-semibold">{{ checkin }}</span> to
                <span class="font-semibold">{{ checkout }}</span>
            </p>

            <div class="max-h-96 overflow-y-auto pr-2 border rounded-lg p-2 bg-gray-50">
                <div class="grid grid-cols-4 gap-2">
                    {% for room in available_rooms %}
                    {% set room_type = '' %}
                    {% if room >= 1 and room <= 50 %} {% set room_type='Suite' %} {% set
                        color='bg-indigo-100 text-indigo-800 border-indigo-300' %} {% elif room>= 51 and room <= 80 %}
                            {% set room_type='Deluxe' %} {% set color='bg-green-100 text-green-800 border-green-300' %}
                            {% elif room>= 81 and room <= 100 %} {% set room_type='Luxury' %} {% set
                                color='bg-red-100 text-red-800 border-red-300' %} {% endif %} <label
                                class="cursor-pointer">
                                <input type="radio" name="room_num" value="{{ room }}" class="hidden peer" required>
                                <div
                                    class="p-2 text-center rounded-lg border-2 {{ color }} hover:border-indigo-500 peer-checked:bg-indigo-500 peer-checked:text-white peer-checked:border-indigo-700 transition duration-150">
                                    <span class="block text-sm font-bold">#{{ room }}</span>
                                    <span class="block text-xs opacity-75">{{ room_type }}</span>
                                </div>
                                </label>
                                {% else %}
                                <p class="col-span-4 text-center text-gray-500 py-4">No rooms available for this period.
                                </p>
                                {% endfor %}
                </div>
            </div>
        </div>

        <!-- Customer Information Panel -->
        <div class="lg:col-span-2 bg-white p-6 rounded-xl container-shadow space-y-4">
            <h2 class="text-xl font-bold text-indigo-600 mb-4">Customer Details</h2>

            <!-- Customer Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="name" name="name" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700">Phone No. (10 Digits)</label>
                    <input type="tel" id="phone" name="phone" pattern="\d{10}" maxlength="10" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
            </div>

            <div>
                <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                <input type="text" id="address" name="address"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="govt_id_type" class="block text-sm font-medium text-gray-700">Govt ID Type</label>
                    <select id="govt_id_type" name="govt_id_type" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                        <option value="">Select ID Type</option>
                        <option value="UID">Aadhaar (UID)</option>
                        <option value="DL">Driving License (DL)</option>
                        <option value="PSP">Passport (PSP)</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="govt_id_number" class="block text-sm font-medium text-gray-700">ID Number</label>
                    <input type="text" id="govt_id_number" name="govt_id_number" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    <p class="text-xs text-gray-500 mt-1">
                        UID: 12 digits | PSP: A-1234567 | DL: AA-12-1990-1234567 (Format is validated on submit)
                    </p>
                </div>
            </div>

            <!-- Submission Button -->
            <button type="submit"
                class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-lg hover:bg-green-700 transition duration-150 transform hover:scale-[1.01] disabled:bg-gray-400"
                {% if not available_rooms %}disabled{% endif %}>
                Confirm Booking (Room & Customer)
            </button>

            {% if not available_rooms %}
            <p class="text-center text-red-600 font-medium mt-4">Cannot book: No rooms available for this date range.
            </p>
            {% endif %}
        </div>

    </div>
</form>
{% endif %}

<div class="mt-8">
    <a href="{{ url_for('booking') }}" class="text-indigo-600 hover:text-indigo-800 font-medium transition">
        <i class="fas fa-chevron-left mr-1"></i> Start a new date search
    </a>
</div>

{% endblock %}